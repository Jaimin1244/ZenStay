@using System.Web
@using Learn_Auth.Attributes;

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewBag.Title - ZenStay</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <!-- Toastr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Custom Style -->
    <link rel="stylesheet" href="~/Content/customStyle.css" />

    <style>

        .loader-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(38, 48, 56, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity : 1;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }

            .loader-container.hidden {
                opacity: 0;
                visibility: hidden;
            }


/* HTML: <div class="loader"></div> */
.loader {
    position: relative;
    width: 64px;
    height: 64px;
    background-color: rgba(0, 0, 0, 0.5);
    transform: rotate(45deg);
    overflow: hidden;
  }
  .loader:after{
    content: '';
    position: absolute;
    inset: 8px;
    margin: auto;
    background: #222b32;
  }
  .loader:before{
    content: '';
    position: absolute;
    inset: -15px;
    margin: auto;
    background: #de3500;
    animation: diamondLoader 2s linear infinite;
  }
  @@keyframes diamondLoader {
    0%  ,10% {
      transform: translate(-64px , -64px) rotate(-45deg)
    }
    90% , 100% {
      transform: translate(0px , 0px) rotate(-45deg)
    }
  }
    </style>


    @Scripts.Render("~/bundles/modernizr")
    @RenderSection("Styles", required: false)
</head>
<body>
    <div class="loader-container" id="loader">
        <span class="loader"></span>
    </div>

    @{
        var profileImage = Session["ProfileImage"] as string;
        var userName = Session["UserName"] as string;
        var role = Session["RoleId"] as int?;

        if (string.IsNullOrEmpty(userName) && Request.Cookies["UserProfile"] != null)
        {
            userName = Request.Cookies["UserProfile"]["UserName"];
            profileImage = Request.Cookies["UserProfile"]["ProfileImage"];
        }

        profileImage = string.IsNullOrEmpty(profileImage) ? Url.Content("~/Content/profile.jpg") : profileImage;
        userName = string.IsNullOrEmpty(userName) ? "User" : userName;
    }


    <!-- Navigation <!-- Navigation -->
    <nav class="navbar navbar-expand-lg sticky-top d-print-none">
        <div class="container container-custom">
            <a class="navbar-brand d-flex align-items-center logo-brand" href="@Url.Action("Index", "Home")">
                <i class="bi bi-building"></i>
                <span>ZenStay</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <!-- Main Navigation Links -->
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link @(ViewBag.ActivePage == "Home" ? "active" : "")" href="@Url.Action("Index", "Home")">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewBag.ActivePage == "About" ? "active" : "")" href="@Url.Action("About", "Home")">About Us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewBag.ActivePage == "Contact" ? "active" : "")" href="@Url.Action("Contact", "Home")">Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link @(ViewBag.ActivePage == "Booking" ? "active" : "")" href="@Url.Action("Create", "Booking")">Book-Room</a>
                    </li>
                </ul>

                <!-- Right side: profile popover or login/register -->
                <div class="d-flex align-items-center">
                    @if (User.Identity.IsAuthenticated)
                    {<img src="@Url.Content(profileImage)" alt="Profile" class="rounded-circle" width="30" height="30">
                        <span class="fw-bold ms-1 text-white">@userName</span>
                        <!-- Profile popover (Hidden on small screens) -->
                        <div class="position-relative d-none d-md-block">
                            <a href="#" id="profilePopover" class="nav-link" data-bs-toggle="popover" data-bs-html="true" data-bs-content='
                                <div class="popover-body">
                                    @if(role == 2)
                                    {
                                        <a class="dropdown-item" href="@Url.Action("Dashboard", "Owner")"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
                                    }
                                    <a class="dropdown-item" href="@Url.Action("Profile", "Account")"><i class="bi bi-person me-2"></i> My Profile</a>
                                    <a class="dropdown-item" href="@Url.Action("UserBookings", "Booking")"><i class="bi bi-bookmark-check me-2"></i> My Bookings</a>
                                    <a class="dropdown-item" href="@Url.Action("Settings", "User")"><i class="bi bi-gear me-2"></i> Settings</a>
                                    <hr class="dropdown-divider">
                                    <a class="dropdown-item text-danger" href="@Url.Action("Logout", "Account")"><i class="bi bi-box-arrow-right me-2"></i> Logout</a>
                                </div>'>
                                <i class="bi bi-gear fs-5 mx-2"></i> <!-- Three dots instead of username -->
                            </a>
                        </div>

                        <!-- Offcanvas Menu (For small screens) -->
                        <button class="btn btn-outline-light d-md-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
                            <i class="bi bi-list"></i> Menu
                        </button>
                    }
                    else
                    {
                        <a href="@Url.Action("Login", "Account")" class="btn btn-outline-light me-2">Login/Register</a>
                    }
                </div>
            </div>
        </div>
    </nav>


    <!-- Offcanvas Sidebar for Authenticated Users on Small Screens -->
    @if (User.Identity.IsAuthenticated)
    {
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel" style="width: 35%;">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasSidebarLabel">Menu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">
                            <img src="@Url.Content(profileImage)" class="rounded-circle mb-2" width="40" height="40" alt="Profile Picture" />
                            @userName
                        </h5>
                    </div>
                </div>
                <div class="list-group">
                    <a href="@Url.Action("Dashboard", "Owner")" class="list-group-item list-group-item-action">
                        <i class="bi bi-speedometer2 me-2"></i> Dashboard
                    </a>
                    <a href="@Url.Action("Profile", "Account")" class="list-group-item list-group-item-action">
                        <i class="bi bi-person me-2"></i> My Profile
                    </a>
                    <a href="@Url.Action("Bookings", "User")" class="list-group-item list-group-item-action">
                        <i class="bi bi-bookmark-check me-2"></i> My Bookings
                    </a>
                    <a href="@Url.Action("Settings", "User")" class="list-group-item list-group-item-action">
                        <i class="bi bi-gear me-2"></i> Settings
                    </a>
                    <a href="@Url.Action("Logout", "Account")" class="list-group-item list-group-item-action text-danger">
                        <i class="bi bi-box-arrow-right me-2"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    }

    <!-- Main Content -->
    <main class="container-custom my-1">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="d-print-none">
        <div class="container container-custom">
            <div class="row">
                <div class="col-md-3">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="@Url.Action("Index", "Home")">Home</a></li>
                        <li><a href="@Url.Action("About", "Home")">About Us</a></li>
                        <li><a href="@Url.Action("Contact", "Home")">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Follow Us</h5>
                    <ul class="list-inline social-icons">
                        <li class="list-inline-item">
                            <a href="#" title="Facebook"><i class="bi bi-facebook"></i></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#" title="Twitter"><i class="bi bi-twitter"></i></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="#" title="Instagram"><i class="bi bi-instagram"></i></a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Contact</h5>
                    <p>Email: <a href="mailto:support@zenstay.com">support@zenstay.com</a></p>
                    <p>Phone: <a href="tel:+1234567890">+1 234 567 890</a></p>
                </div>
                <div class="col-md-3">
                    <h5>Newsletter</h5>
                    <form id="newsletter-form">
                        <div class="mb-3">
                            <input type="email" class="form-control" placeholder="Your Email" required />
                        </div>
                        <button type="submit" class="btn btn-primary btn-sm">Subscribe</button>
                    </form>
                </div>
            </div>
            <hr class="bg-secondary">
            <div class="text-center">
                <p class="mb-0">&copy; @DateTime.Now.Year ZenStay. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- External Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- GSAP Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/ScrollTrigger.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

   <script>
       document.addEventListener("DOMContentLoaded", function () {
           setTimeout(function () {
               document.getElementById("loader").classList.add("hidden"); // Hide loader after 1.5s delay
           }, 1500);
       });


    window.addEventListener("beforeunload", function () {
        document.getElementById("loader").classList.remove("hidden"); // Show loader before navigating to another page
    });

       window.addEventListener("pageshow", function (event) {
           if (event.persisted) {
               setTimeout(function () {
                   document.getElementById("loader").classList.add("hidden"); // Hide loader after 1.5s delay
               }, 1500); // Hide loader if page is restored from cache (Back button)
           }
       });
</script>

    <!-- Add a div to load the response -->
    <div id="content"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var popoverTrigger = document.getElementById("profilePopover");
            var popover = new bootstrap.Popover(popoverTrigger, {
                placement: "bottom",
                trigger: "click",
                container: "body"
            });

            // Close popover when clicking outside
            document.addEventListener("click", function (event) {
                if (!popoverTrigger.contains(event.target)) {
                    popover.hide();
                }
            });
        });
    </script>
    <script>

        toastr.options = {
            "closeButton": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": true,
            "timeOut": "5000",
            "onclick": null,
            "extendedTimeOut": "0",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "slideDown",
            "hideMethod": "slideUp"
        }

    $(document).ready(function () {
        var success = '@TempData["SuccessMessage"]';
        var error = '@TempData["ErrorMessage"]';
        var warn = '@TempData["WarnMessage"]';

        if (success) {
            toastr.success(success);
        }
        if (error) {
            toastr.error(error);
        }
        if (warn) {
            toastr.warning(warn);
        }
    });
    </script>
    <!-- Custom Script -->
    <script src="~/Scripts/customScript.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
